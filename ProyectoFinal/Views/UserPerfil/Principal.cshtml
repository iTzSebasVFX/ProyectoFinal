@model ProyectoFinal.Models.UsViewModel

<!DOCTYPE html>
<html lang="es">

@inject Microsoft.AspNetCore.Http.IHttpContextAccessor HttpContextAccessor

@{
    var NombreUsuario = HttpContextAccessor.HttpContext?.Session.GetString("NombreUser");
}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visor de Imágenes</title>
    <script src="https://kit.fontawesome.com/0ec24d2dc8.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="~/css/personas.css">
</head>

<body>
    <div class="container">
        <nav class="menu">

            <input type="checkbox" id="toggle">

            <button class="Chat">
                <a class="ChatT" asp-action="ZonaChat" asp-controller="UserPerfil">Chat</a>
            </button>

            <button class="Chat">
                <a class="ChatT" asp-action="PruebasChatPriv" asp-controller="Chat">Lista Chats</a>
            </button>

            <button class="juegos">
                <a class="ZonaJ" asp-action="Juegos" asp-controller="UserPerfil">Zona de Juegos</a>
            </button>


            <button class="Sesion">
                <a class="cerrar" asp-action="CerrarSesion" asp-controller="UserPerfil">Cerrar Sesion</a>
            </button>

            <button class="perfil">
                <a class="perfilsec" asp-action="Perfil" asp-controller="UserPerfil">Perfil</a>
            </button>
        </nav>

        <button class="perfil">
            <a class="perfilsec" asp-action="ListaInvi" asp-controller="UserPerfil">Invitaciones</a>
        </button>

        <button onclick="mostrarFiltros()">Filtrar</button>

        <!-- Título superior -->
        @if (!string.IsNullOrEmpty(NombreUsuario))
        {
            <h1>Bienvenido, @NombreUsuario</h1>
        }
        else
        {
            <h1>No hay usuario en sesion</h1>
        }
        <div class="title">
            Personas con las que podrías interactuar
        </div>
      
        @if (TempData["Error"] != null) {
            <div class="alert alert-danger" id="alertError">
                @TempData["Error"]
            </div>
        }
        @if (TempData["Exito"] != null)
        {
            <div class="alert alert-success" id="alertError">
                @TempData["Exito"]
            </div>
        }
        <div class="modalFiltros" id="ocultar" style="display: none;">
            <button onclick="ocultarFiltros()">✖️</button>
            <form asp-action="PrincipalFiltrado" asp-controller="UserPerfil" method="get" class="row g-2">
                <div class="col-md-3">
                    <select name="Genero" class="form-select">
                        <option value="">Todos los géneros</option>
                        <option value="Masculino">Masculino</option>
                        <option value="Femenino">Femenino</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="Pais" class="form-select">
                        <option value="">Todos los países</option>
                        <option value="Colombia">Colombia</option>
                        <option value="México">México</option>
                        <option value="Argentina">Argentina</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select name="Edad" class="form-select">
                        <option value="">Todas las edades</option>
                        <option value="18-25">18 a 25 años</option>
                        <option value="26-35">26 a 35 años</option>
                        <option value="36-45">36 a 45 años</option>
                        <option value="46+">46 años o más</option>
                    </select>
                </div>
                <div class="col-md-12 text-end">
                    <button type="submit" class="btn btn-primary">Aplicar filtros</button>
                </div>
            </form>
        </div>
        @if (Model.NuevoUsuario.Edad >= 18)
        {
            <!-- Animacion -->
            @foreach (var item in Model.ListaUsu)
            {
                @if (string.IsNullOrEmpty(item.FotoRuta))
                {
                    <img class="image-container" id="imageContainer" src="/uploads/fotosinfoto.png" alt="Foto de perfil" width="150"
                        height="150" />
                }
                else
                {
                    <img class="image-container" id="imageContainer"
                        src="@Url.Content(item.FotoRuta ?? " ~/uploads/fotosinfoto.png")" alt="No funciono" width="150" height="150"
                        onerror="this.onerror=null; this.src='/uploads/fotosinfoto.png';" />
                }
                <br>
                <br>
                <a asp-action="PruebasChatPriv" asp-controller="Chat" asp-route-itemid="@item.id">Invitar a Room</a>
                <br>
                <br>
                <div class="details-container">
                    <h3>Informacion Usuario</h3>
                    @if (string.IsNullOrEmpty(item.nombreCompleto) || string.IsNullOrEmpty(item.Genero))
                    {
                        <p id="imageDetails">Usuario con datos incompletos...</p>
                    }
                    else
                    {
                        <p id="imageDetails">Nombre = @item.nombreCompleto</p>
                        <p id="imageDetails">Genero = @item.Genero</p>
                    }
                </div>

            }
        }
        else
        {
            <p>Su edad no es lo suficiente para conocer personas, Presione el boton para modificar su perfil</p>
            <a asp-action="Perfil" asp-controller="UserPerfil">Editar Perfil</a>
        }
        <script src="~/js/Tema.js"></script>
        <script asp-append-version="true">
            formFiltros = document.getElementById("ocultar");
            function mostrarFiltros() {
                formFiltros.style.display = "block";
            }
            function ocultarFiltros() {
                formFiltros.style.display = "none";
            }
            setTimeout(() => {
                let alertElement = document.getElementById("alertError");
                if (alertElement) {
                    alertElement.style.display = "none";
                }
            }, 5000); // Desaparece en 5 segundos
        </script>
</body>

</html>